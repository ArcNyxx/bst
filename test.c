/* bst - binary search tree
 * Copyright (C) 2022 ArcNyxx
 * see LICENCE file for licensing information */

#include <stdarg.h>
#include <stdio.h>
#include <stdlib.h>

#include "bst.h"

bst_find_t valarr[160] = {
	-30597, -27469,   8359,  -8551,  -9833, -29674,   5784, -14002,
	 11713,  23446,  24058,  -9615,  20884, -16325, -23934,  18675,
	-30792,  15197, -14157,   2470, -17170, -27628, -31831, -19192,
	-12273, -10452,  32130, -12500,  28225,  -9330, -20879,  13250,
	 10991,  -8874, -28407, -25326,  30174,  -6321,   -482,  29480,
	 16875,   7802,  31874, -17738, -31506,  23479,  12639,  14949,
	 30017,  17297,   4697,  13031,  -9170,  24181,  16118,   1982,
	-15000,  22655, -18157, -23171,  15953,   8485,  12952,  17342,
	  4673,  16467, -20991, -29207, -12799, -28891,  23309, -29083,
	-30467,   4787, -12650, -26794, -23719,  14177,  25168,  19218,
	 27286, -30675,    172, -31223,    647,  24907,  26193,  -6769,
	  2181, -13427,   4754,  11993,  21070,  23729,   7422, -10244,
	  7820, -23869, -12320, -13282,  -9692,    458,  -9952,  21424,
	 19021,  30779,  20842, -19210,  -3232,  31637,  15407, -14277,
	 24203,  -7118,  -1443,  -9230, -11773, -27134, -17848,  13501,
	 -8119,  -2647,  32000, -24875,   5047, -26606,   7592,  32015,
	 23434, -19896,   6740, -18461,  26333,  31406,  21133,   5232,
	 19117,  28458,  30310, -29601,  -4041,  31411,  18694,  -6211,
	-15326, -27381,  -7481,   5559,  11205,   9374, -14028,  11241,
	 -1000,  26359, -18773,  18741,   1601,    790, -29726, -15744
};

bst_find_t errarr[10][16] = {
	{   8485, -14028, -19210,   8359,   7820,  16118,  17342,  19117,
	    -482,  15407,  -9330,  24181,  30017, -18157, -20991,   5784 },
	{ -27134,  30779,  13031, -18773,  12639,  -9833, -31506,   6740,
	  -28407, -12799, -29674, -27469,  26359,   4754,  26193,  25168 },
	{  15953, -23719,   2181,  11713,  13501,  23479, -29083,   5047,
	  -30792,  18741, -10452,  -9692,  -2647,   5232,  19021,  19218 },
	{  31874,   7592,   5559, -17170,  -3232,  30174, -20879, -28891,
	    7422,  14177,  30310,   4787,  -9615,  24907,  23446,   7802 },
	{  32130,  26333, -23171,  28225, -24875,  24058, -29601, -29726,
	   -9170, -30675,  31406,  -8551,  23729,  -6211, -15744,  24203 },
	{ -12500, -27381,    172, -12320,   4673,  12952,  16467, -25326,
	    1982,  14949, -15000,   2470,  -8874, -17848,  20842, -19896 },
	{  32000, -30597,  32015,  11993, -19192, -13427,  -6769,  -7118,
	   27286,  11241,  31411,  20884,  17297,  29480, -11773,   9374 },
	{  -8119,  -4041,  18694,  21070, -17738,  13250, -14002,  16875,
	  -13282, -10244,    790,  31637,   1601, -31831, -30467,  10991 },
	{  23434,  -9230, -14157,  22655,  18675, -26794, -27628, -23869,
	   -1443, -26606, -16325, -12650, -18461,  -6321,  28458,  21424 },
	{    647,    458,   4697,  21133, -14277, -15326, -12273, -23934,
	   -1000,  15197, -31223,  23309,  11205,  -9952,  -7481, -29207 }
};

bst_find_t fndarr[5] = { 31406, -6211, 17342, 32000, -19728 };

static void
die(const char *fmt, ...)
{
	va_list ap;
	va_start(ap, fmt);
	vfprintf(stderr, fmt, ap);
	va_end(ap);

	exit(1);
}

int
main(void)
{
	bst_t tree = { 0 };
	fprintf(stderr, "bst: sizeof node: %lld\n", sizeof(bsn_t));

	for (size_t i = 0; i < 160; ++i)
		if (!bst_addn(&tree, bsn_init(valarr[i])))
			die("bst: unable to add element: %lld\n", valarr[i]);

	for (size_t i = 0; i < 5; ++i)
		fprintf(stderr, "bst: %20s %20lld\n",
				bst_find(&tree, fndarr[i]) != NULL ?
				"found" : "not found", fndarr[i]);

	fprintf(stderr, "\nbst: %20lld %20lld\n",
			bst_minn(&tree), bst_maxn(&tree));
	for (size_t i = 0; i < 10; ++i) {
		for (size_t j = 0; j < 16; ++j) {
			bsn_t *rem;
			if ((rem = bst_remn(&tree, errarr[i][j])) == NULL)
				die("bst: unable to remove element: %lld",
						errarr[i][j]);
			free(rem);
		}
		fprintf(stderr, "bst: %20lld %20lld\n", bst_minn(&tree),
				bst_maxn(&tree));
	}
	
	for (size_t i = 0; i < 160; ++i)
		if (!bst_addn(&tree, bsn_init(valarr[i])))
			die("bst: unable to add element: %d\n", valarr[i]);
	if (bst_dest(&tree)->root != NULL)
		die("bst: unable to destroy all elements\n");
}
